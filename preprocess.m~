function [ outIm ] = preprocess( im )
imbw = im2bw(im, graythresh(im));
imbw = 1 - imbw;

[r,c] = find(imbw > 0);
rowoutlierinds = find(abs(r-mean(r)) > 3 * std(r));
coloutlierinds = find(abs(c-mean(c)) > 3 * std(c));


dists = [r,c] - repmat([mu_r,mu_c],[size(r,1),1]);
dists = sqrt(sum(abs(dists).^2,2));
toofarinds = find(dists>mean(dists) + 2*std(dists));
toofar = sub2ind(size(imbw), r(toofarinds), c(toofarinds));

imbw(toofar) = 0;

colSums = sum(imbw,1);
rowSums = sum(imbw,2);


filledCols = find(colSums > 0);
filledRows = find(rowSums > 0);

minCol = min(filledCols);
maxCol = max(filledCols);
minRow = min(filledRows);
maxRow = max(filledRows);

outIm = imbw(minRow:maxRow, minCol:maxCol);

colormap('gray');
imagesc(outIm);

end

